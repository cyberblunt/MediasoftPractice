# Система оценки ресторанов

## Описание проекта

Система оценки ресторанов - это Spring Boot приложение, которое позволяет посетителям оставлять отзывы и оценки ресторанов. Приложение реализовано с использованием Spring Data JPA для работы с базой данных.

## Технологии

- **Java 17**
- **Spring Boot 3.2.0**
- **Spring Data JPA**
- **H2 Database** (in-memory)
- **Gradle**
- **Lombok**

## Структура проекта

### Сущности (Entities)

- **Visitor** - посетитель ресторана
  - id (Long, автоинкремент)
  - name (String, может быть null для анонимных отзывов)
  - age (int, обязательное поле)
  - gender (String, обязательное поле)

- **Restaurant** - ресторан
  - id (Long, автоинкремент)
  - name (String, обязательное поле)
  - description (String, может быть пустым)
  - cuisineType (CuisineType enum, обязательное поле)
  - averageCheck (BigDecimal, обязательное поле)
  - rating (BigDecimal, оценка пользователей)

- **Rating** - оценка/отзыв
  - id (Long, автоинкремент)
  - visitor (Visitor, связь ManyToOne)
  - restaurant (Restaurant, связь ManyToOne)
  - score (int, обязательное поле)
  - review (String, может быть пустым)

- **CuisineType** - перечисление типов кухни
  - EUROPEAN, ITALIAN, CHINESE, JAPANESE, INDIAN, MEXICAN, RUSSIAN, FRENCH, THAI, MEDITERRANEAN

### Репозитории (Repositories)

Все репозитории наследуются от `JpaRepository` и предоставляют стандартные CRUD операции:

- **VisitorRepository** - работа с посетителями
- **RestaurantRepository** - работа с ресторанами
- **RatingRepository** - работа с оценками
  - findByRestaurantId(Long restaurantId) - поиск оценок по ресторану
  - findByVisitorId(Long visitorId) - поиск оценок по посетителю

### Сервисы (Services)

- **VisitorService** - бизнес-логика для работы с посетителями
- **RestaurantService** - бизнес-логика для работы с ресторанами
- **RatingService** - бизнес-логика для работы с оценками
  - Автоматический пересчет среднего рейтинга ресторана при добавлении/удалении оценок

## Конфигурация базы данных

Приложение использует H2 in-memory базу данных с следующими настройками:

- URL: jdbc:h2:mem:restaurantdb
- Пользователь: sa
- Пароль: password
- H2 Console доступен по адресу: http://localhost:8080/h2-console

## Запуск приложения

1. Убедитесь, что у вас установлена Java 17 или выше
2. Клонируйте репозиторий
3. Выполните команду для запуска:
   ```bash
   ./gradlew bootRun
   ```

## Тестовые данные

При запуске приложения автоматически создаются тестовые данные:

- 3 посетителя (включая одного анонимного)
- 3 ресторана с разными типами кухни
- 6 оценок от посетителей

## API Endpoints

Приложение предоставляет REST API для работы с данными:

- GET /visitors - получить всех посетителей
- POST /visitors - создать нового посетителя
- DELETE /visitors/{id} - удалить посетителя

- GET /restaurants - получить все рестораны
- POST /restaurants - создать новый ресторан
- DELETE /restaurants/{id} - удалить ресторан

- GET /ratings - получить все оценки
- POST /ratings - создать новую оценку
- DELETE /ratings/{id} - удалить оценку

## Особенности реализации

1. **Автоматическая генерация ID** - все сущности используют автоинкремент для первичных ключей
2. **Связи между сущностями** - Rating связан с Visitor и Restaurant через JPA отношения
3. **Автоматический пересчет рейтинга** - при добавлении или удалении оценки автоматически пересчитывается средний рейтинг ресторана
4. **Поддержка анонимных отзывов** - посетители могут оставлять отзывы без указания имени
5. **Транзакционность** - операции с оценками выполняются в транзакциях

## Логирование

Приложение настроено для вывода SQL запросов в консоль для отладки. Уровень логирования можно настроить в `application.properties`.

## Разработка

Для разработки рекомендуется использовать IDE с поддержкой Spring Boot (IntelliJ IDEA, Eclipse, VS Code).

Проект использует Gradle для сборки и управления зависимостями. 
